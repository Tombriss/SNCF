{% extends 'base.html' %}

{% block body %}

<style>
	table {
	  border-collapse: collapse;
	  border-spacing: 0;
	  width: 100%;
	  border: 1px solid #ddd;
	  background-color: rgb(255, 255, 255);
	  text-align: center;
	  table-layout: fixed ;

	}
	
	th, td {
	  text-align: center;
	  padding: 8px;
	  width: 25% ;
	}
	
	tr:nth-child(even){background-color: #f2f2f2}

	#tabtrains tr:hover {
					background-color: rgba(160, 217, 235, 0.705);
					cursor: pointer;
				}
	
</style>

<script>
	const logout = async () => {
	const response = await $.ajax({
		url : "../logout/", // the endpoint
		type : "POST", // http method
	})
	console.log(response)

	window.location.href = '../../'

	$(document).ready(function() {
		$('#user').text(function(i, oldText) {
		return '';})
	})}

	const submitReq = async () => {	
		const from = document.getElementById("from").value
		const to = document.getElementById("to").value
		const date = document.getElementById("date").value

		const response = await $.ajax({
		    url : "agency/logger/", // the endpoint
		    type : "POST", // http method
			data : {'from':from,'to':to,'date':date}
		})
		console.log(firstname)
		console.log(response)

		document.location.reload(true);

		console.log("rel")
	}

// data sent with the post request
</script>

<div class="container-fluid">
    <div class="row1 row">
        <div class="col-lg-4">
            <span class="sty" style="font-size:50px;">Book your train!</span>
		</div>
		<div class="col-lg-6"></div>
		<div class="col-lg-1"><span id="user" class="sty2" style="font-size:17px;"> {{request.session.firstname}}  {{request.session.name}} </span></div>
		<div class="col-lg-1"><button class="btn btn-danger" onclick="logout()">Log Out</button></div>	
	</div>

<div ng-app="Myapp">
<h1 class="sty" style="font-size:70px;" align="center">What is your next journey?</h1>
	<br><br>

	<div ng-controller="MyController" style="margin-top:10px;" class="rounded">

		
		<div class="row"> 

		<div class="col-lg-2"></div>
		<div class="sty2 col-lg-2 col-md-4 col-sm-4" >
            <b>From</b>
		<br><input id ="from" type="text" class="input" ng-model="src"/ value = "Lyon">
		</div>
		<div class="sty2 col-lg-2 col-md-4 col-sm-4">
			<b>To</b>
		<br><input id ="to" type="text" class="input" ng-model="dest"/ value = "Paris">
		</div>
		<div class="sty2 col-lg-2 col-md-4 col-sm-4">
			<b>Date</b>
		<br><input  id ="date" type="date" class="input" ng-model="dt" placeholder="DD-MM-YYYY" />
		</div>
		<div class="col-lg-2">
			<br>
			<button type="button" ng-click="submitReq()">Submit</button>
		</div>

		</div>
		
		
		<br/><br/>
		

	</div>

	</div>

	<div class="center-div" style="overflow:auto;">
		<table style="overflow: scroll ;white-space: nowrap; text-align:center" >
			<tr>
			<th>Train NÂ°</th>
			<th>Departure</th>
			<th>Arrival</th>
			<th>Available sits</th>
			<th>Price</th>
		  </tr>
	</table>
	</div>
	
	<div class="center-div" style="height:250px; overflow:auto;">
		<table id="tabtrains" style="overflow: scroll ;white-space: nowrap; text-align:center" >
			<tbody id="tbod"></tbody>
		</table>
	  </div>

<script>

trains = [
	{"id":"132342","departure":"08:00","arrival":"10:00","sits":"324","price":"32"},
	{"id":"983457","departure":"08:00","arrival":"10:00","sits":"324","price":"34"},
	{"id":"I4U543","departure":"08:00","arrival":"10:00","sits":"324","price":"50"},
	{"id":"394752","departure":"08:00","arrival":"10:00","sits":"324","price":"12"},
	{"id":"4349873","departure":"08:00","arrival":"10:00","sits":"324","price":"65"},
	{"id":"34789","departure":"08:00","arrival":"10:00","sits":"324","price":"14"},
	{"id":"345292","departure":"08:00","arrival":"10:00","sits":"324","price":"20"},
	]

	var tbody = document.getElementById("tbod")

	for (var i = 0; i < trains.length; i++) {

		var tr = "<tr>";

		/* Must not forget the $ sign */

		train = trains[i]

		for (var key in train){
			tr += "<td id='"+train.id+"'>" + train[key] + "</td>";
		}

		tr += "</tr>"

		/* We add the table row to the table body */
		tbody.innerHTML += tr;
	}

	$(document).on('click', 'tr', function(e) {
		const id_train = e.target.id
		if (id_train.length>0){
		window.location.href = '../payement/'+id_train
		}
	})



</script>
	  

{% endblock %}